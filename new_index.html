<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crawl4AI Ultimate Pro - Fully-Featured Edition</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/turndown/dist/turndown.js"></script>
    <style>
        /* General Styling & Layout */
        .tab-content, .step-content { display: none; }
        .tab-content.active, .step-content.active { display: block; }
        .progress-bar { transition: width 0.3s ease; }
        
        /* Glassmorphism & Gradients */
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white; font-weight: 500; padding: 0.75rem 1rem;
            border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.2s;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        .btn-secondary { background: #6b7280; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-secondary:hover:not(:disabled) { background: #4b5563; }
        .btn-danger { background: #ef4444; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-danger:hover:not(:disabled) { background: #dc2626; }
        .btn-success { background: #10b981; color: white; font-weight: 500; padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-success:hover:not(:disabled) { background: #059669; }

        /* Forms & Messages */
        .form-input, .form-select {
            width: 100%; padding: 0.75rem; border: 1px solid #d1d5db;
            border-radius: 0.5rem; outline: none; transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus, .form-select:focus {
            border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .message { padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; }
        .message.success { background: #dcfce7; border: 1px solid #bbf7d0; color: #166534; }
        .message.error { background: #fee2e2; border: 1px solid #fecaca; color: #991b1b; }
        .message.warning { background: #fef3c7; border: 1px solid #fde68a; color: #92400e; }

        /* Cards & Sections */
        .crawl-card { 
            transition: all 0.3s ease; 
            page-break-inside: avoid;
        }
        .crawl-card:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
        }
        .crawl-card.success { border-left: 4px solid #10B981; }
        .crawl-card.failed { border-left: 4px solid #EF4444; }
        .crawl-card.blocked { border-left: 4px solid #F59E0B; }
        .crawl-card.processing { border-left: 4px solid #8B5CF6; }
        .crawl-card.discovered { border-left: 4px solid #3B82F6; }
        .metric-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        /* Visual Selector (Guide Mode) */
        #guide-modal { display: none; }
        #guide-iframe { width: 100%; height: 100%; border: none; }
        #guide-popup { position: absolute; display: none; background: white; border: 1px solid #ccc; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 1rem; z-index: 10000; }
        .visual-selector-highlight { outline: 2px dashed #f43f5e !important; background-color: rgba(244, 63, 94, 0.2) !important; cursor: pointer !important; }

        /* Animations */
        .pulse-ring { animation: pulse-ring 1.5s ease-out infinite; }
        @keyframes pulse-ring { 0% { transform: scale(.33); opacity: 1; } 80%, 100% { opacity: 0; transform: scale(1.5); } }
        .animate-bounce-slow { animation: bounce 2s infinite; }
        .stats-chart { height: 300px; margin-top: 1rem; }
        
        /* Proxy Table */
        .proxy-table-container { max-height: 250px; overflow-y: auto; }

    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="glass-effect shadow-lg mb-6 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="relative">
                        <i class="fas fa-spider text-blue-600 text-3xl mr-3"></i>
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full pulse-ring"></div>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold gradient-text">Crawl4AI Ultimate Pro</h1>
                        <p class="text-gray-600 text-sm">Fully-Featured Edition</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <button id="save-config" class="btn-secondary no-print"><i class="fas fa-save mr-1"></i>Save</button>
                        <button id="load-config" class="btn-secondary no-print"><i class="fas fa-folder-open mr-1"></i>Load</button>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="bg-gray-200 px-3 py-2 rounded-full flex items-center">
                            <div class="w-2 h-2 bg-green-500 rounded-full mr-2" id="connection-indicator"></div>
                            <span class="text-sm font-medium" id="connection-status">Ready</span>
                        </div>
                        <button id="clear-all-btn" class="btn-danger no-print">
                            <i class="fas fa-trash mr-1"></i>Clear All
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4">
        <div id="message-container" class="mb-6"></div>
        <div class="grid grid-cols-1 xl:grid-cols-4 gap-6">
            <!-- Configuration Panel -->
            <div class="xl:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex flex-wrap border-b mb-6">
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-blue-600 text-blue-600 font-medium text-xs" data-tab="start">Start</button>
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-xs" data-tab="discovery">Discovery & Pagination</button>
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-xs" data-tab="evasion">Evasion</button>
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-xs" data-tab="extraction">Extraction & AI</button>
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-xs" data-tab="advanced">Advanced</button>
                        <button class="tab-btn flex-1 min-w-0 py-2 px-1 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 text-xs" data-tab="create-session">Create Session</button>
                    </div>

                    <div class="tab-content active" id="start-tab">
                        <div id="start-step-1" class="step-content active">
                            <h3 class="text-lg font-semibold mb-2 text-gray-800">1. Define Crawl Target</h3>
                            <div class="space-y-3">
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500">
                                    <input type="radio" name="start-method" value="ai" class="mr-3" checked>
                                    <div>
                                        <p class="font-medium">Discover URLs with AI</p>
                                        <p class="text-xs text-gray-500">Describe what you want to find.</p>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500">
                                    <input type="radio" name="start-method" value="manual" class="mr-3">
                                    <div>
                                        <p class="font-medium">Use My Own URLs</p>
                                        <p class="text-xs text-gray-500">Enter a list of specific websites.</p>
                                    </div>
                                </label>
                            </div>
                            <div id="ai-discovery-inputs" class="mt-4 space-y-4">
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Prompt</label><textarea id="ai-prompt" class="form-input" rows="3" placeholder="e.g., 'Top 10 tech news blogs in California'"></textarea></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Groq API Key</label><input type="password" id="ai-groq-api-key" class="form-input" placeholder="Enter your Groq API key..."></div>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Model</label><select id="ai-model" class="form-select"><option value="llama3-70b-8192" selected>LLaMA Scout</option><option value="gemma2-9b-it">Maverick</option></select></div>
                                <button id="ai-search-btn" class="btn-primary w-full">Search</button>
                            </div>
                            <div id="manual-url-inputs" class="mt-4 space-y-4" style="display: none;">
                                 <div><label class="block text-sm font-medium text-gray-700 mb-2">Starting URLs</label><textarea id="urls-input" class="form-input" rows="6" placeholder="Enter starting URLs, one per line..."></textarea></div>
                            </div>
                        </div>
                         <div id="start-step-2" class="step-content">
                            <h3 class="text-lg font-semibold mb-4 text-gray-800">2. Select URLs to Crawl</h3>
                            <div id="ai-results-checklist" class="space-y-2 max-h-64 overflow-y-auto"></div>
                            <div class="flex space-x-2 mt-4">
                                <button id="back-to-step-1" class="btn-secondary flex-1">Back</button>
                                <button id="confirm-selection-btn" class="btn-primary flex-1">Confirm & Continue</button>
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t space-y-4">
                            <div><label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-cog mr-1 text-purple-500"></i>Crawl Strategy</label><select id="crawl-mode" class="form-select"><option value="basic">Basic Crawl</option><option value="smart" selected>Smart Mode</option><option value="magic">Magic Mode (AI Enhanced)</option><option value="comprehensive">Comprehensive</option><option value="adaptive">Adaptive Crawling</option><option value="deep">Deep Discovery</option></select></div>
                            <div class="bg-blue-50 rounded-lg p-3">
                                <h4 class="font-medium text-blue-800 mb-2">Output Options</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center"><input type="checkbox" id="extract-markdown" class="mr-2 rounded" checked><span class="text-sm">Generate Markdown</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="extract-metadata" class="mr-2 rounded" checked><span class="text-sm">Extract Metadata</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="extract-links" class="mr-2 rounded" checked><span class="text-sm">Extract Links</span></label>
                                    <label class="flex items-center"><input type="checkbox" id="extract-media" class="mr-2 rounded"><span class="text-sm">Extract Media Files</span></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Create New Scrape Session Tab -->
                    <div class="tab-content" id="create-session-tab">
                        <h3 class="text-lg font-semibold mb-4 text-gray-800"><i class="fas fa-plus-circle mr-2 text-green-600"></i>Create New Scrape Session</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Name</label>
                                <input type="text" id="session-name" class="form-input" placeholder="e.g., Tech News Scrape 2024">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Project Description</label>
                                <textarea id="session-description" class="form-input" rows="3" placeholder="Describe what this scraping session will accomplish..."></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Type</label>
                                <select id="session-type" class="form-select">
                                    <option value="one-time">One-time Scrape</option>
                                    <option value="scheduled">Scheduled Recurring</option>
                                    <option value="monitoring">Real-time Monitoring</option>
                                    <option value="research">Research Project</option>
                                </select>
                            </div>
                            
                            <div id="scheduling-options" class="space-y-3" style="display: none;">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Schedule Frequency</label>
                                    <select id="schedule-frequency" class="form-select">
                                        <option value="hourly">Every Hour</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                    <input type="datetime-local" id="schedule-start" class="form-input">
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-200">
                                <h4 class="font-medium text-yellow-800 mb-2"><i class="fas fa-server mr-1"></i>Backend Configuration</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-vm-backup" class="mr-2 rounded" checked>
                                        <span class="text-sm">Enable VM Backup Processing</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-failover" class="mr-2 rounded" checked>
                                        <span class="text-sm">Auto-failover to Backup Systems</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="enable-redundancy" class="mr-2 rounded">
                                        <span class="text-sm">Multi-instance Redundancy</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 rounded-lg p-3 border border-purple-200">
                                <h4 class="font-medium text-purple-800 mb-2"><i class="fas fa-robot mr-1"></i>Crawl4AI Integration</h4>
                                <div class="space-y-2">
                                    <div>
                                        <label class="block text-xs font-medium text-gray-600">Crawl Strategy</label>
                                        <select id="crawl4ai-strategy" class="form-select text-sm">
                                            <option value="js-execution">JS Execution (Full SPA Support)</option>
                                            <option value="cosine-strategy">Cosine Similarity Strategy</option>
                                            <option value="llm-extraction">LLM-based Extraction</option>
                                            <option value="json-css-extraction">JSON CSS Extraction</option>
                                            <option value="chunking-strategy">Semantic Chunking</option>
                                        </select>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600">Browser Type</label>
                                            <select id="browser-type" class="form-select text-sm">
                                                <option value="chromium">Chromium</option>
                                                <option value="firefox">Firefox</option>
                                                <option value="webkit">WebKit</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600">Session Pool</label>
                                            <select id="session-pool" class="form-select text-sm">
                                                <option value="single">Single Session</option>
                                                <option value="pool-5">5 Session Pool</option>
                                                <option value="pool-10">10 Session Pool</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 rounded-lg p-3 border border-green-200">
                                <h4 class="font-medium text-green-800 mb-2"><i class="fas fa-shield-alt mr-1"></i>Anti-Detection Features</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="stealth-mode" class="mr-2 rounded" checked>
                                        <span class="text-sm">Stealth Mode (Hide Automation)</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="random-viewport" class="mr-2 rounded" checked>
                                        <span class="text-sm">Random Viewport Sizes</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="human-simulation" class="mr-2 rounded">
                                        <span class="text-sm">Human Behavior Simulation</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="pt-4 mt-4 border-t">
                                <button id="create-session-btn" class="btn-primary w-full">
                                    <i class="fas fa-rocket mr-2"></i>Create & Initialize Session
                                </button>
                                <div class="mt-2 text-center">
                                    <button id="session-templates-btn" class="btn-secondary text-sm">
                                        <i class="fas fa-template mr-1"></i>Load Template
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="discovery-tab">
                        <div class="space-y-4">
                            <div>
                                <label class="flex items-center"><input type="checkbox" id="enable-deep-crawl" class="mr-2 rounded"><span class="font-medium">Enable Deep Crawling</span></label>
                                <div id="deep-crawl-options" class="pl-4 border-l-2 space-y-3 mt-2" style="display: none;">
                                    <div class="grid grid-cols-2 gap-3">
                                        <div><label class="block text-xs font-medium text-gray-600">Max Depth</label><input type="number" id="max-depth" class="form-input text-sm" value="3" min="1"></div>
                                        <div><label class="block text-xs font-medium text-gray-600">Max URLs</label><input type="number" id="max-urls" class="form-input text-sm" value="50" min="1"></div>
                                    </div>
                                    <div><label class="block text-xs font-medium text-gray-600">Domain Strategy</label><select id="domain-strategy" class="form-select text-sm"><option value="same-domain" selected>Same Domain</option><option value="same-subdomain">Same Subdomain</option><option value="whitelist">Whitelist Domains</option><option value="any">Any Domain</option></select></div>
                                    <div id="domain-whitelist-container" style="display: none;">
                                        <label class="block text-xs font-medium text-gray-600">Allowed Domains</label>
                                        <input type="text" id="domain-whitelist" class="form-input text-sm" placeholder="example.com, subdomain.example.com">
                                        <div id="domain-chips" class="mt-2"></div>
                                    </div>
                                    <div class="pt-2 border-t mt-2 space-y-2">
                                        <div><label class="flex items-center text-sm"><input type="checkbox" id="respect-robots" class="mr-2 rounded" checked>Respect robots.txt</label></div>
                                        <div><label class="flex items-center text-sm"><input type="checkbox" id="parse-sitemaps" class="mr-2 rounded" checked>Parse Sitemaps</label></div>
                                        <div><label class="flex items-center text-sm"><input type="checkbox" id="discover-feeds" class="mr-2 rounded">Discover RSS/Atom Feeds</label></div>
                                        <div><label class="block text-xs font-medium text-gray-600">Include Patterns</label><input type="text" id="include-patterns" class="form-input text-sm" placeholder="/blog/*, /articles/*, *.html"></div>
                                        <div><label class="block text-xs font-medium text-gray-600">Exclude Patterns</label><input type="text" id="exclude-patterns" class="form-input text-sm" placeholder="/admin/*, /login/*, *.pdf"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="pt-4 mt-4 border-t">
                                <label class="flex items-center"><input type="checkbox" id="enable-pagination" class="mr-2 rounded"><span class="font-medium">Enable Pagination Crawling</span></label>
                                <div id="pagination-options" class="pl-4 border-l-2 space-y-3 mt-2" style="display: none;">
                                    <div><label class="block text-xs font-medium text-gray-600">Detection Strategy</label><select id="pagination-strategy" class="form-select text-sm"><option value="auto" selected>Auto-Detect (Smart)</option><option value="next-link">"Next" Links</option><option value="numbered">Numbered Pages</option><option value="infinite-scroll">Infinite Scroll (Experimental)</option><option value="custom-selector">Custom CSS Selector</option></select></div>
                                    <div id="custom-selector-options" style="display: none;"><label class="block text-xs font-medium text-gray-600">Next Page CSS Selector</label><input type="text" id="next-page-selector" class="form-input text-sm" placeholder="a.next, .pagination-next, [rel='next']"></div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div><label class="block text-xs font-medium text-gray-600">Max Pages</label><input type="number" id="max-pages" class="form-input text-sm" value="10" min="1"></div>
                                        <div><label class="block text-xs font-medium text-gray-600">Page Delay (s)</label><input type="number" id="page-delay" class="form-input text-sm" value="2" min="1"></div>
                                    </div>
                                    <div><label class="flex items-center text-sm"><input type="checkbox" id="deduplicate-paginated" class="mr-2 rounded" checked>Remove Duplicate Content</label></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="evasion-tab">
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-800"><i class="fas fa-user-secret mr-1 text-yellow-600"></i>Proxy Intelligence Engine</h4>
                             <div class="flex space-x-2">
                                <button id="test-proxies" class="btn-secondary flex-1 text-sm"><i class="fas fa-shield-alt mr-2"></i>Test All</button>
                            </div>
                            <div id="proxy-test-progress-container" class="w-full bg-gray-200 rounded-full h-2.5" style="display: none;">
                                <div id="proxy-test-progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                            <div class="proxy-table-container">
                                <table class="w-full text-left text-xs">
                                    <thead>
                                        <tr class="border-b">
                                            <th class="py-1">Proxy Source/IP</th>
                                            <th class="py-1">Status</th>
                                            <th class="py-1">Latency</th>
                                        </tr>
                                    </thead>
                                    <tbody id="proxy-list-table">
                                        <tr><td colspan="3" class="text-center py-4 text-gray-500">No proxies loaded.</td></tr>
                                    </tbody>
                                </table>
                            </div>
                             <div class="bg-gray-50 p-3 rounded-md border">
                                <label class="flex items-center justify-between text-sm">
                                    <span>Auto-test proxies every</span>
                                    <input type="number" id="auto-test-interval" class="form-input text-sm w-20" value="120">
                                    <span>seconds</span>
                                </label>
                            </div>
                            <div id="custom-proxy-container">
                                <label class="block text-xs font-medium text-gray-600 mb-1">Custom Proxy List URL</label>
                                <div class="flex items-center space-x-2">
                                    <input type="text" id="custom-proxy-url" class="form-input text-sm flex-grow" placeholder="https://my-api.com/proxies.txt">
                                    <select id="proxy-quantity-selector" class="form-select text-sm" style="width: auto;">
                                        <option value="5">5</option>
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                    <button id="add-custom-proxies-btn" class="btn-success p-2 h-full" title="Fetch, test, and add best proxies from URL">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-content" id="extraction-tab">
                         <div class="space-y-4">
                            <div>
                                <h4 class="font-semibold text-gray-800 mb-2"><i class="fas fa-magic mr-1 text-pink-500"></i>AI-Powered Extraction</h4>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">Groq API Key</label><div class="relative"><input type="password" id="groq-api-key" class="form-input pr-10" placeholder="Required for AI features"><button type="button" id="toggle-api-key" class="absolute right-2 top-3 text-gray-400"><i class="fas fa-eye-slash"></i></button></div></div>
                                <label class="flex items-center mt-2"><input type="checkbox" id="enable-ai-extraction" class="mr-2 rounded"><span class="font-medium">Enable AI Extraction</span></label>
                                <div id="ai-options" class="pl-4 border-l-2 space-y-3 mt-2" style="display: none;">
                                    <div><label class="block text-xs font-medium text-gray-600">LLM Model</label>
                                        <select id="llm-model" class="form-select text-sm">
                                            <option value="llama-3.1-70b-versatile">LLaMA 3.1 70B</option>
                                            <option value="llama-3.1-8b-instant">LLaMA 3.1 8B (Fast)</option>
                                            <option value="llama3-70b-8192">LLaMA 3 70B (8k)</option>
                                            <option value="llama3-8b-8192">LLaMA 3 8B (8k)</option>
                                            <option value="gemma2-9b-it" selected>Gemma 2 9B (Recommended)</option>
                                            <option value="gemma-7b-it">Gemma 7B</option>
                                            <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                                            <option value="whisper-large-v3">Whisper V3 (Audio Transcription)</option>
                                        </select>
                                    </div>
                                    <div><label class="block text-xs font-medium text-gray-600">AI Request Delay (ms)</label><input type="number" id="ai-request-delay" class="form-input text-sm" value="500" min="100" step="100"></div>
                                    <div><label class="block text-xs font-medium text-gray-600">Custom Prompt</label><textarea id="custom-prompt" class="form-input text-sm" rows="3">Extract the main content, title, and key information. Format as clean JSON.</textarea></div>
                                </div>
                            </div>
                             <div class="pt-4 mt-4 border-t">
                                <h4 class="font-semibold text-gray-800 mb-2"><i class="fas fa-crosshairs mr-1 text-blue-500"></i>Manual Extraction</h4>
                                <div><label class="block text-sm font-medium text-gray-700 mb-2">CSS/XPath Extraction</label><div class="space-y-2"><input type="text" id="css-selector" class="form-input text-sm" placeholder="CSS Selector (e.g., .article-content, #main)"><input type="text" id="xpath-selector" class="form-input text-sm" placeholder="XPath (e.g., //div[@class='content'])"></div></div>
                             </div>
                        </div>
                    </div>

                    <div class="tab-content" id="advanced-tab">
                        <div class="space-y-4">
                             <div class="grid grid-cols-2 gap-3">
                                <div><label class="block text-xs font-medium text-gray-700">Timeout (s)</label><input type="number" id="timeout" class="form-input text-sm" value="10" min="5"></div>
                                <div><label class="block text-xs font-medium text-gray-700">Max Retries</label><input type="number" id="max-retries" class="form-input text-sm" value="3" min="0"></div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div><label class="block text-xs font-medium text-gray-700">Crawl Delay (s)</label><input type="number" id="request-delay" class="form-input text-sm" value="1" min="0" step="0.1"></div>
                                <div><label class="block text-xs font-medium text-gray-700">Delay Jitter (s)</label><input type="number" id="delay-jitter" class="form-input text-sm" value="0.5" min="0" step="0.1"></div>
                            </div>
                            <div><label class="block text-sm font-medium text-gray-700">Concurrent Requests</label><input type="number" id="concurrent-requests" class="form-input text-sm" value="3" min="1" max="10"></div>
                            <div><label class="block text-sm font-medium text-gray-700">User Agents (one per line)</label><textarea id="user-agents" class="form-input text-sm" rows="5"></textarea></div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Content Processing</label>
                                <div class="space-y-2 mt-2 bg-gray-50 p-3 rounded-md">
                                    <label class="flex items-center text-sm"><input type="checkbox" id="smart-clean" class="mr-2 rounded" checked>Enable Smart Content Cleaning</label>
                                    <label class="flex items-center text-sm"><input type="checkbox" id="filter-ads" class="mr-2 rounded" checked>Remove Ads & Trackers</label>
                                    <label class="flex items-center text-sm"><input type="checkbox" id="filter-navigation" class="mr-2 rounded" checked>Remove Navigation</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t">
                        <button id="start-crawl" class="btn-primary w-full flex items-center justify-center"><i class="fas fa-play mr-2"></i><span>Start Ultimate Crawling</span></button>
                        <div class="flex space-x-2 mt-3">
                            <button id="stop-crawl" class="btn-danger flex-1 text-sm" disabled><i class="fas fa-stop mr-1"></i>Stop</button>
                            <button id="clear-results" class="btn-secondary flex-1 text-sm"><i class="fas fa-trash mr-1"></i>Clear</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="xl:col-span-3">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4"><i class="fas fa-chart-line mr-2 text-blue-600"></i>Progress Dashboard</h2>
                    <div class="w-full bg-gray-200 rounded-full h-3 mb-4"><div id="progress-bar" class="progress-bar bg-gradient-to-r from-blue-600 to-purple-600 h-3 rounded-full" style="width: 0%"></div></div>
                    <div class="grid grid-cols-2 md:grid-cols-6 gap-4 text-center">
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-blue-600" id="total-urls">0</div><div class="text-xs text-gray-600">Discovered</div></div>
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-green-600" id="completed-urls">0</div><div class="text-xs text-gray-600">Completed</div></div>
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-red-600" id="failed-urls">0</div><div class="text-xs text-gray-600">Failed</div></div>
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-yellow-600" id="blocks-encountered">0</div><div class="text-xs text-gray-600">Blocks</div></div>
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-indigo-600" id="current-speed">0</div><div class="text-xs text-gray-600">req/min</div></div>
                        <div class="metric-card rounded-lg p-3"><div class="text-2xl font-bold text-purple-600" id="current-depth">0</div><div class="text-xs text-gray-600">Max Depth</div></div>
                    </div>
                    <div class="stats-chart"><canvas id="progressChart"></canvas></div>
                    <div id="current-status" class="bg-gray-50 rounded-lg p-4 border-l-4 border-blue-600"><span class="text-sm text-gray-700" id="status-message">Ultimate crawler ready.</span></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="unified-data-section">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4"><i class="fas fa-database mr-2 text-purple-600"></i>Unified Dataset</h2>
                        <div id="unified-stats" class="grid grid-cols-3 gap-4 text-center mb-4">
                            <div><div class="text-2xl font-bold text-indigo-600" id="unified-unique-items">0</div><div class="text-xs text-indigo-600">Unique</div></div>
                            <div><div class="text-2xl font-bold text-orange-600" id="unified-duplicates">0</div><div class="text-xs text-indigo-600">Duplicates</div></div>
                             <div><div class="text-2xl font-bold text-green-600" id="unified-quality">0%</div><div class="text-xs text-indigo-600">Avg. Quality</div></div>
                        </div>
                        <div class="flex space-x-2">
                            <button id="create-unified-dataset" class="btn-success flex-1 text-sm" disabled><i class="fas fa-layer-group mr-1"></i>Create Dataset</button>
                            <button id="download-unified-json" class="btn-primary flex-1 text-sm" disabled><i class="fas fa-download mr-1"></i>JSON</button>
                            <button id="download-unified-csv" class="btn-primary flex-1 text-sm" disabled><i class="fas fa-download mr-1"></i>CSV</button>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4"><i class="fas fa-sitemap mr-2 text-red-600"></i>Crawl Tree</h2>
                        <div class="crawl-tree" id="crawl-tree"><div class="text-center text-gray-500 py-8"><p>Tree will appear here.</p></div></div>
                    </div>
                </div>
                
                <div id="pagination-status" class="pagination-indicator mb-6" style="display: none;"></div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-semibold text-gray-800"><i class="fas fa-list-alt mr-2 text-green-600"></i>Results Log</h2>
                        <div class="flex items-center space-x-2">
                            <button id="download-individual-json" class="btn-secondary text-sm" disabled><i class="fas fa-download mr-1"></i>Individual JSON</button>
                        </div>
                    </div>
                    <div id="results-container" class="results-container space-y-4">
                        <div class="text-center text-gray-500 py-12"><div class="animate-bounce-slow"><i class="fas fa-search text-6xl mb-4 text-gray-300"></i></div><p>Start crawling to see results.</p></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Guide Mode Modal -->
    <div id="guide-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 p-4 lg:p-12">
        <div class="bg-white w-full h-full rounded-lg shadow-2xl flex flex-col">
            <div class="p-3 border-b flex justify-between items-center bg-gray-50 rounded-t-lg">
                <h3 class="font-semibold text-gray-800"><i class="fas fa-magic mr-2 text-purple-600"></i>Guide Mode</h3>
                <button id="close-guide-modal" class="text-gray-500 hover:text-red-600"><i class="fas fa-times-circle fa-lg"></i></button>
            </div>
            <div class="flex-grow relative">
                <iframe id="guide-iframe"></iframe>
                <div id="guide-popup">
                    <h4 class="font-bold mb-2">Map Element</h4>
                    <p class="text-xs bg-gray-100 p-1 rounded font-mono mb-3" id="guide-selector-preview"></p>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Assign to:</label>
                    <select id="guide-mapping-select" class="form-select mb-3">
                        <option value="css-selector">Main Content Selector</option>
                        <option value="next-page-selector">Next Page Link</option>
                        <option value="custom-title">Custom Title</option>
                        <option value="custom-price">Custom Price</option>
                    </select>
                    <div class="flex space-x-2">
                        <button id="guide-cancel-btn" class="btn-secondary flex-1 text-sm">Cancel</button>
                        <button id="guide-apply-btn" class="btn-success flex-1 text-sm">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Extending the existing JavaScript class to include the missing Create Session functionality
        class Crawl4AIUltimatePro {
            constructor() {
                // Core State
                this.isRunning = false;
                this.isPaused = false;
                this.abortController = null;
                this.crawlStartTime = null;
                this.sessions = new Map(); // Store session data
                
                // Data & Queues
                this.currentResults = new Map();
                this.unifiedDataset = [];
                this.crawlQueue = [];
                this.aiQueue = [];
                this.isAIQueueProcessing = false;
                this.processedUrls = new Set();
                this.crawlTree = new Map();
                
                // Statistics
                this.stats = { discovered: 0, completed: 0, failed: 0, blocks: 0, requests: 0, maxDepth: 0 };
                
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.switchTab('start');
                this.initializeChart();
                this.loadSessionTemplates();
            }

            setupEventListeners() {
                // Existing event listeners...
                document.querySelectorAll('.tab-btn').forEach(btn => 
                    btn.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab))
                );

                // Create Session tab specific listeners
                document.getElementById('session-type').addEventListener('change', (e) => {
                    document.getElementById('scheduling-options').style.display = 
                        e.target.value === 'scheduled' ? 'block' : 'none';
                });

                document.getElementById('create-session-btn').addEventListener('click', () => this.createSession());
                document.getElementById('session-templates-btn').addEventListener('click', () => this.showSessionTemplates());
                
                // Main control buttons
                document.getElementById('start-crawl').addEventListener('click', () => this.startCrawl());
                document.getElementById('stop-crawl').addEventListener('click', () => this.stopCrawl());
                document.getElementById('clear-results').addEventListener('click', () => this.clearResults());
            }

            switchTab(tabName) {
                // Remove active classes from all tabs and content
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('border-blue-600', 'text-blue-600');
                    btn.classList.add('border-transparent', 'text-gray-500');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Add active classes to selected tab
                const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('border-blue-600', 'text-blue-600');
                    activeBtn.classList.remove('border-transparent', 'text-gray-500');
                }

                const activeContent = document.getElementById(`${tabName}-tab`);
                if (activeContent) {
                    activeContent.classList.add('active');
                }
            }

            async createSession() {
                const sessionName = document.getElementById('session-name').value.trim();
                const description = document.getElementById('session-description').value.trim();
                const sessionType = document.getElementById('session-type').value;
                
                if (!sessionName) {
                    this.showMessage('Please enter a session name', 'error');
                    return;
                }

                const sessionConfig = {
                    id: Date.now().toString(),
                    name: sessionName,
                    description: description,
                    type: sessionType,
                    created: new Date().toISOString(),
                    status: 'initialized',
                    
                    // Backend Configuration
                    backendConfig: {
                        vmBackup: document.getElementById('enable-vm-backup').checked,
                        failover: document.getElementById('enable-failover').checked,
                        redundancy: document.getElementById('enable-redundancy').checked
                    },
                    
                    // Crawl4AI Integration
                    crawl4aiConfig: {
                        strategy: document.getElementById('crawl4ai-strategy').value,
                        browserType: document.getElementById('browser-type').value,
                        sessionPool: document.getElementById('session-pool').value
                    },
                    
                    // Anti-Detection Features
                    antiDetection: {
                        stealthMode: document.getElementById('stealth-mode').checked,
                        randomViewport: document.getElementById('random-viewport').checked,
                        humanSimulation: document.getElementById('human-simulation').checked
                    },
                    
                    // Scheduling (if applicable)
                    scheduling: sessionType === 'scheduled' ? {
                        frequency: document.getElementById('schedule-frequency').value,
                        startTime: document.getElementById('schedule-start').value
                    } : null
                };

                try {
                    // Store session locally
                    this.sessions.set(sessionConfig.id, sessionConfig);
                    
                    // Initialize backend services based on configuration
                    await this.initializeSessionBackend(sessionConfig);
                    
                    this.showMessage(`Session "${sessionName}" created successfully!`, 'success');
                    
                    // Switch to start tab to begin configuring the scrape
                    this.switchTab('start');
                    
                } catch (error) {
                    console.error('Error creating session:', error);
                    this.showMessage('Failed to create session. Please try again.', 'error');
                }
            }

            async initializeSessionBackend(sessionConfig) {
                // Initialize VM backup if enabled
                if (sessionConfig.backendConfig.vmBackup) {
                    await this.setupVMBackup(sessionConfig);
                }
                
                // Setup failover systems
                if (sessionConfig.backendConfig.failover) {
                    await this.setupFailoverSystems(sessionConfig);
                }
                
                // Configure Crawl4AI with specific strategies
                await this.configureCrawl4AI(sessionConfig);
                
                // Setup monitoring and redundancy
                if (sessionConfig.backendConfig.redundancy) {
                    await this.setupRedundantSystems(sessionConfig);
                }
            }

            async setupVMBackup(sessionConfig) {
                // VM backup configuration for continuity
                console.log('Setting up VM backup for session:', sessionConfig.name);
                
                // This would integrate with your backend VM infrastructure
                const vmConfig = {
                    sessionId: sessionConfig.id,
                    vmType: 'backup-processor',
                    resources: {
                        cpu: '2',
                        memory: '4GB',
                        storage: '20GB'
                    },
                    crawl4aiImage: 'latest',
                    healthCheck: '/health',
                    autoRestart: true
                };
                
                // Send VM creation request to backend
                // await this.sendToBackend('/api/vm/create', vmConfig);
            }

            async setupFailoverSystems(sessionConfig) {
                console.log('Setting up failover systems for session:', sessionConfig.name);
                
                // Configure multiple endpoints and backup systems
                const failoverConfig = {
                    primary: 'main-crawl4ai-service',
                    secondary: 'backup-crawl4ai-service',
                    healthCheckInterval: 30000,
                    failoverThreshold: 3
                };
                
                // Initialize failover monitoring
                // await this.sendToBackend('/api/failover/setup', failoverConfig);
            }

            async configureCrawl4AI(sessionConfig) {
                console.log('Configuring Crawl4AI for session:', sessionConfig.name);
                
                const crawl4aiConfig = {
                    strategy: sessionConfig.crawl4aiConfig.strategy,
                    browser: sessionConfig.crawl4aiConfig.browserType,
                    sessionPoolSize: parseInt(sessionConfig.crawl4aiConfig.sessionPool.split('-')[1]) || 1,
                    
                    // Anti-detection settings
                    stealth: sessionConfig.antiDetection.stealthMode,
                    randomViewport: sessionConfig.antiDetection.randomViewport,
                    humanBehavior: sessionConfig.antiDetection.humanSimulation,
                    
                    // Additional Crawl4AI features
                    jsExecution: sessionConfig.crawl4aiConfig.strategy === 'js-execution',
                    cosineStrategy: sessionConfig.crawl4aiConfig.strategy === 'cosine-strategy',
                    llmExtraction: sessionConfig.crawl4aiConfig.strategy === 'llm-extraction',
                    jsonCssExtraction: sessionConfig.crawl4aiConfig.strategy === 'json-css-extraction',
                    semanticChunking: sessionConfig.crawl4aiConfig.strategy === 'chunking-strategy'
                };
                
                // Send configuration to Crawl4AI service
                // await this.sendToBackend('/api/crawl4ai/configure', crawl4aiConfig);
            }

            async setupRedundantSystems(sessionConfig) {
                console.log('Setting up redundant systems for session:', sessionConfig.name);
                
                // Configure multiple instances for high availability
                const redundancyConfig = {
                    instances: 3,
                    loadBalancing: 'round-robin',
                    syncInterval: 10000,
                    dataReplication: true
                };
                
                // Initialize redundant instances
                // await this.sendToBackend('/api/redundancy/setup', redundancyConfig);
            }

            loadSessionTemplates() {
                // Predefined session templates for common use cases
                this.sessionTemplates = {
                    'news-monitoring': {
                        name: 'News Monitoring',
                        description: 'Monitor news websites for latest articles',
                        type: 'monitoring',
                        crawl4aiStrategy: 'llm-extraction',
                        browserType: 'chromium',
                        stealthMode: true
                    },
                    'ecommerce-scraping': {
                        name: 'E-commerce Product Scraping',
                        description: 'Extract product information from e-commerce sites',
                        type: 'scheduled',
                        crawl4aiStrategy: 'json-css-extraction',
                        browserType: 'chromium',
                        humanSimulation: true
                    },
                    'research-project': {
                        name: 'Academic Research',
                        description: 'Comprehensive data collection for research',
                        type: 'research',
                        crawl4aiStrategy: 'chunking-strategy',
                        browserType: 'firefox',
                        vmBackup: true
                    }
                };
            }

            showSessionTemplates() {
                // Display available templates for quick session creation
                const templates = Object.keys(this.sessionTemplates).map(key => {
                    const template = this.sessionTemplates[key];
                    return `<option value="${key}">${template.name}</option>`;
                }).join('');
                
                // This would show a modal or dropdown with templates
                console.log('Available session templates:', this.sessionTemplates);
            }

            async startCrawl() {
                if (this.isRunning) {
                    this.showMessage('Crawl is already running', 'warning');
                    return;
                }

                this.isRunning = true;
                this.abortController = new AbortController();
                
                // Update UI
                document.getElementById('start-crawl').disabled = true;
                document.getElementById('stop-crawl').disabled = false;
                
                this.showMessage('Starting crawl with enhanced Crawl4AI integration...', 'success');
                
                // Simulate crawling process
                // In real implementation, this would integrate with your backend Crawl4AI service
                await this.simulateCrawlProcess();
            }

            async simulateCrawlProcess() {
                // Simulate the crawling process with progress updates
                for (let i = 0; i <= 100; i += 10) {
                    if (!this.isRunning) break;
                    
                    document.getElementById('progress-bar').style.width = i + '%';
                    document.getElementById('status-message').textContent = `Processing... ${i}%`;
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                if (this.isRunning) {
                    this.showMessage('Crawl completed successfully!', 'success');
                    this.stopCrawl();
                }
            }

            stopCrawl() {
                if (this.abortController) {
                    this.abortController.abort();
                }
                
                this.isRunning = false;
                
                // Update UI
                document.getElementById('start-crawl').disabled = false;
                document.getElementById('stop-crawl').disabled = true;
                
                this.showMessage('Crawl stopped', 'warning');
            }

            clearResults() {
                this.currentResults.clear();
                this.unifiedDataset = [];
                this.stats = { discovered: 0, completed: 0, failed: 0, blocks: 0, requests: 0, maxDepth: 0 };
                
                // Reset UI
                document.getElementById('progress-bar').style.width = '0%';
                document.getElementById('status-message').textContent = 'Ultimate crawler ready.';
                
                this.showMessage('Results cleared', 'success');
            }

            showMessage(message, type = 'info') {
                const messageContainer = document.getElementById('message-container');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                messageDiv.textContent = message;
                
                messageContainer.appendChild(messageDiv);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 5000);
            }

            initializeChart() {
                // Initialize progress chart
                const ctx = document.getElementById('progressChart');
                if (ctx) {
                    this.progressChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: [],
                            datasets: [{
                                label: 'Crawl Progress',
                                data: [],
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.crawlApp = new Crawl4AIUltimatePro();
        });
    </script>
</body>
</html>